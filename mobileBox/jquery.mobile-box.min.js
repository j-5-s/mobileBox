// mobileBox - jQuery lightbox for mobile plugin
// (c) 2012 James Charlesworth - JamesCharlesworth.com
// License: http://www.opensource.org/licenses/mit-license.php
(function(e,t,n){"use strict";e.fn.mobileBox=function(r){var i={counter:"{i} of {t}",isTouch:"ontouchstart"in t.documentElement,disableWithMaxWidth:480};e.extend(i,r),e(this).addClass("_mobileBox"),e(this).click(function(t){if(s>i.disableWithMaxWidth||!i.isTouch)return;var n=e(this).attr("href"),r=e(this).attr("title"),o=e(this).attr("class").split(" "),u=new Image;u.src=n;var h=[];for(var p=0;p<o.length;p++){var d=o[p];if(d==="_mobileBox")continue;var v=e("."+d);for(var m=0;m<v.length;m++){var g=v[m];h.indexOf(g)===-1&&h.push(g)}}var y=e(h).index(this);return f(u,function(t,s,o){var u=h.length?h.length:1,f=i.counter.replace("{i}",y+1).replace("{t}",u),p=e(a.replace("{src}",n).replace("{title}",r).replace("{counter}",f));e(".mobileBox",p).append(this),e(".mobileBoxDone a",p).bind("click",l),e("body").prepend(p),c(e(".mobileBox"),h,y)}),!1});var s=e(n).width(),o=e(n).height(),u="landscape",a=['<div class="mobileBoxWrapper">','<div class="mobileBoxBg"></div>','<div class="mobileBox">','<div class="mobileBoxHeader">','<span class="mobileBoxDone"><a href="#done">Done</a></span>','<span class="mobileBoxCounter">{counter}</span>',"</div>",'<div class="mobileBoxTitle">{title}</div>',"</div>","<div>"].join(""),f=function(t,n){e(t).load(function(r){var i=r.currentTarget;i.width<i.height&&(u="portrait");var s=o-i.height;s=s>=0?s/4+30:0,e(t).css({"margin-top":s+"px"}),n.call(t,i.width,i.height,s)})},l=function(){return e(".mobileBoxWrapper").fadeOut(function(){e(this).remove()}),!1},c=function(t,r,i){function h(e){var t=e.originalEvent.targetTouches[0];a.x=t.pageX,a.y=t.pageY}function p(e){var t=e.originalEvent.targetTouches[0];l.x=t.pageX,l.y=t.pageY,e.preventDefault()}function d(){}function v(){var e=a.y-l.y,t,n=c.threshold,r=n.y,i=n.x;e<r&&e>-r&&(t=a.x-l.x,t>i?c.swipeLeft.call(o):t<-i&&c.swipeRight.call(o))}var o=t,u=function(t){if(i+t>=0&&i+t<r.length){var n=i+t,o=e(r[n]);e(".mobileBox img").animate({left:(t<0?"+":"-")+"="+s},200,function(){e(this).remove()});var u=new Image;u.src=o.attr("href"),f(u,function(i,u,a){var f={};t>0?(e(this).css({right:"-"+s+"px"}),f.right="0px"):(e(this).css({left:"-"+s+"px"}),f.left="0px"),e(".mobileBoxTitle").html(o.attr("title")),e(".mobileBoxCounter").html(n+1+" of "+r.length),e(".mobileBox").append(this),e(this).animate(f,200)}),i+=t}};n.load=u;var a={x:0,y:0},l={x:0,y:0},c={threshold:{x:3,y:10},swipeLeft:function(){u(1)},swipeRight:function(){u(-1)}};e(o).bind("touchstart.swipe",h).bind("touchmove.swipe",p).bind("touchend.swipe",v).bind("touchcancel.swipe",d)}}})(jQuery,document,this);